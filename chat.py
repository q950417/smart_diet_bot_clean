# chat.py  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# åªåšã€Œé—œéµå­— â†’ å›è¦†ã€èˆ‡ã€Œæ’ç‰ˆç‡Ÿé¤Šçµæœã€ï¼Œå®Œå…¨ä¸ç¢°ç¶²è·¯æˆ– GPTã€‚
# ----------------------------------------------------------------------

import re
from typing import Final, Dict

TRIGGERS: Final[Dict[str, str]] = {
    # â”€â”€ æ‰“æ‹›å‘¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    r"^(hi|hello)$":          "Hello! ğŸ˜Š  æƒ³æŸ¥é£Ÿç‰©ç‡Ÿé¤Šå—ï¼Ÿå‚³æ–‡å­—æˆ–ç…§ç‰‡çµ¦æˆ‘å§ï¼",
    r"^(å“ˆå›‰|ä½ å¥½|å—¨+)$":     "å—¨å—¨ï½è«‹å‘Šè¨´æˆ‘ä½ åƒäº†ä»€éº¼ï¼Œæˆ‘ä¾†å ±ç‡Ÿé¤Šï¼",
    # â”€â”€ ç”Ÿæ´»åŒ–ç¯„ä¾‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    r"è¬è¬":                  "ä¸å®¢æ°£ï½ç¥ä½ ç”¨é¤æ„‰å¿«ï¼",
    r"(æ—©å®‰|good\s*morning)": "æ—©å®‰â˜€ï¸  æ—©é¤è¨˜å¾—å‡è¡¡ç‡Ÿé¤Šå–”ï¼",
    r"(æ™šå®‰|good\s*night)":   "æ™šå®‰ï½ç¡å‰åˆ¥åƒå¤ªå¤šå®µå¤œå–”ï¼",
    # â˜… æƒ³å†åŠ ï¼Œå°±å¾€ä¸‹åŠ  ------------------------------------------------
    # r"æ¯”è–©":                 "æ¯”è–©ç†±é‡é€šå¸¸ä¸ä½ï¼Œè¨˜å¾—æ­é…è”¬èœï¼",
}


def try_reply(text: str) -> str | None:
    """
    å‘½ä¸­ä»»ä¸€ TRIGGERS å°±å›è¦†ï¼›å¦å‰‡å› None è®“ä¸»ç¨‹å¼å»æŸ¥ç‡Ÿé¤Šã€‚
    æ¯”å°æ™‚ä¸€å¾‹è½‰å°å¯«ã€å»ç©ºç™½ï¼›æ­£å‰‡ç”¨ IGNORECASE ã€‚
    """
    t = text.strip().lower()
    for pattern, reply in TRIGGERS.items():
        if re.search(pattern, t, flags=re.IGNORECASE):
            return reply
    return None


# â”€â”€ ä»¥ä¸‹æ˜¯æ’ç‰ˆç‡Ÿé¤Šè³‡è¨Š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def advice_by_calories(kcal: int) -> str:
    if kcal < 200:
        return "ç†±é‡å¾ˆä½ï¼Œå¯ä»¥æ”¾å¿ƒäº«ç”¨ï½"
    if kcal < 400:
        return "ç†±é‡ä¸­ç­‰ï¼Œè¨˜å¾—å‡è¡¡é£²é£Ÿã€‚"
    return "ç†±é‡åé«˜ï¼Œå»ºè­°æ­é…è”¬èœæˆ–åˆ†æ¬¡é£Ÿç”¨ï¼"


def format_nutrition(info: dict) -> str:
    return (
        f"{info['name']} ä¼°ç®—ç‡Ÿé¤Šï¼š\n"
        f"ç†±é‡ {info['calories']} kcal\n"
        f"è›‹ç™½è³ª {info['protein']} g | "
        f"è„‚è‚ª {info['fat']} g | "
        f"ç¢³æ°´ {info['carbs']} g\n"
        f"{advice_by_calories(info['calories'])}"
    )


#å¯ä»¥çš„
def try_greet(text: str) -> str | None:
    """
    å¦‚æœä½¿ç”¨è€…æ˜¯åœ¨æ‰“æ‹›å‘¼ï¼Œå°±å›å›ºå®šå­—ä¸²ï¼›å¦å‰‡å› None
    """
    if text.lower() in {"hi", "hello", "å“ˆå›‰", "ä½ å¥½"}:
        return "å—¨ï¼æƒ³çŸ¥é“é£Ÿç‰©çš„ç‡Ÿé¤Šå—ï¼Ÿå‚³æ–‡å­—æˆ–ç…§ç‰‡çµ¦æˆ‘å§ï¼"
    return None


# ------------------------------------------------------------------------------


def advice_by_calories(kcal: int) -> str:
    """ä¾ç†±é‡çµ¦ç°¡å–®å»ºè­°ï¼ˆç´” if-elseã€ä¸ç”¨ GPTï¼‰"""
    if kcal < 200:
        return "ç†±é‡å¾ˆä½ï¼Œå¯ä»¥æ”¾å¿ƒäº«ç”¨ï½"
    if kcal < 400:
        return "ç†±é‡ä¸­ç­‰ï¼Œè¨˜å¾—å‡è¡¡é£²é£Ÿã€‚"
    return "ç†±é‡åé«˜ï¼Œå»ºè­°æ­é…è”¬èœæˆ–åˆ†æ¬¡é£Ÿç”¨ï¼"


def format_nutrition(info: dict) -> str:
    """æŠŠ Spoonacular å›å‚³çš„ç‡Ÿé¤Šè³‡è¨Šæ’ç‰ˆæˆ Line è¨Šæ¯"""
    return (
        f"{info['name']} ä¼°ç®—ç‡Ÿé¤Šï¼š\n"
        f"ç†±é‡ {info['calories']} kcal\n"
        f"è›‹ç™½è³ª {info['protein']} g | "
        f"è„‚è‚ª {info['fat']} g | "
        f"ç¢³æ°´ {info['carbs']} g\n"
        f"{advice_by_calories(info['calories'])}"
    )

#=========================================
# chat.py
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# åªè™•ç†æœ€ç°¡å–®çš„ã€Œé—œéµå­— â†’ å›ºå®šå›è¦†ã€é‚è¼¯ï¼Œç„¡ GPT ä¾è³´
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# ===== 1) æ–‡å­—è§¸ç™¼è¡¨ =====
# key  å¯ä»¥æ”¾å¤šå€‹åŒç¾©å­—ï¼ˆç”¨ | åˆ†éš”ï¼‰æˆ–æ­£è¦è¡¨é”å¼
# val  å°±æ˜¯è¦å›çµ¦ä½¿ç”¨è€…çš„æ–‡å­—
# TRIGGERS: dict[str, str] = {
#     r"^(hi|hello)$":                    "Hello! ğŸ˜Š  æƒ³æŸ¥é£Ÿç‰©ç‡Ÿé¤Šå—ï¼Ÿå‚³æ–‡å­—æˆ–ç…§ç‰‡çµ¦æˆ‘å§ï¼",
#     r"^(å“ˆå›‰|ä½ å¥½|å—¨+)$":               "å—¨å—¨ï½è«‹å‘Šè¨´æˆ‘ä½ åƒäº†ä»€éº¼ï¼Œæˆ‘ä¾†å ±ç‡Ÿé¤Šï¼",
#     r"è¬è¬":                            "ä¸å®¢æ°£ï½ç¥ä½ ç”¨é¤æ„‰å¿«ï¼",
#     r"(æ—©å®‰|good\s*morning)":           "æ—©å®‰â˜€ï¸  æ—©é¤è¨˜å¾—å‡è¡¡ç‡Ÿé¤Šå–”ï¼",
#     r"(æ™šå®‰|good\s*night)":             "æ™šå®‰ï½ç¡å‰åˆ¥åƒå¤ªå¤šå®µå¤œå–”ï¼",
#     # â†“ è‡ªè¡Œè¿½åŠ 
#     # r"æ¯”è–©":                           "æ¯”è–©ç†±é‡é€šå¸¸ä¸ä½ï¼Œè¨˜å¾—æ­é…è”¬èœï¼",
# }

# # ===== 2) æ–‡å­—æ¯”å°å‡½å¼ =====
# import re

# def try_reply(text: str) -> str | None:
#     """
#     è‹¥ç¬¦åˆä»»ä¸€è§¸ç™¼è¦å‰‡å°±å›è¦†å°æ‡‰æ–‡å­—ï¼Œå¦å‰‡å›å‚³ Noneã€‚
#     - æ¯”å°æ™‚ä¸€å¾‹è½‰æˆå°å¯«ã€å»æ‰ç©ºç™½ï¼Œé¿å…å¤§å°å¯«å·®ç•°ã€‚
#     - è¦å‰‡ç”¨ `re.IGNORECASE`ï¼Œå¯«ä¸­æ–‡æ™‚ä¸ç”¨åœ¨æ„å¤§å°å¯«ã€‚
#     """
#     t = text.strip().lower()
#     for pattern, reply in TRIGGERS.items():
#         if re.search(pattern, t, flags=re.IGNORECASE):
#             return reply
#     return None


# # ===== 3) çµ¦ç‡Ÿé¤Šçµæœæ™‚ç”¨çš„è¨Šæ¯æ ¼å¼ =====
# def advice_by_calories(kcal: int) -> str:
#     if kcal < 200:
#         return "ç†±é‡å¾ˆä½ï¼Œå¯ä»¥æ”¾å¿ƒäº«ç”¨ï½"
#     if kcal < 400:
#         return "ç†±é‡ä¸­ç­‰ï¼Œè¨˜å¾—å‡è¡¡é£²é£Ÿã€‚"
#     return "ç†±é‡åé«˜ï¼Œå»ºè­°æ­é…è”¬èœæˆ–åˆ†æ¬¡é£Ÿç”¨ï¼"


# def format_nutrition(info: dict) -> str:
#     """æŠŠ food_classifier å›å‚³çš„ dict è½‰æˆå‹å–„æ–‡å­—"""
#     return (
#         f"{info['name']} ä¼°ç®—ç‡Ÿé¤Šï¼š\n"
#         f"ç†±é‡ {info['calories']} kcal\n"
#         f"è›‹ç™½è³ª {info['protein']} g | è„‚è‚ª {info['fat']} g | ç¢³æ°´ {info['carbs']} g\n"
#         f"{advice_by_calories(info['calories'])}"
#     )



# # chat.py
# def try_greet(text: str) -> str | None:
#     if text.lower() in {"hi", "hello", "å“ˆå›‰", "ä½ å¥½"}:
#         return "å—¨ï¼æƒ³çŸ¥é“é£Ÿç‰©çš„ç‡Ÿé¤Šå—ï¼Ÿå‚³æ–‡å­—æˆ–ç…§ç‰‡çµ¦æˆ‘å§ï¼"
#     return None

# def advice_by_calories(kcal: int) -> str:
#     if kcal < 200:
#         return "ç†±é‡å¾ˆä½ï¼Œå¯ä»¥æ”¾å¿ƒäº«ç”¨ï½"
#     if kcal < 400:
#         return "ç†±é‡ä¸­ç­‰ï¼Œè¨˜å¾—å‡è¡¡é£²é£Ÿã€‚"
#     return "ç†±é‡åé«˜ï¼Œå»ºè­°æ­é…è”¬èœæˆ–åˆ†æ¬¡é£Ÿç”¨ï¼"

# def format_nutrition(info: dict) -> str:
#     return (
#         f"{info['name']} ä¼°ç®—ç‡Ÿé¤Šï¼š\n"
#         f"ç†±é‡ {info['calories']} kcal\n"
#         f"è›‹ç™½è³ª {info['protein']} g | è„‚è‚ª {info['fat']} g | ç¢³æ°´ {info['carbs']} g\n"
#         f"{advice_by_calories(info['calories'])}"
#     )
